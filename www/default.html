<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>zCloud云桌面</title>
    <link rel="Shortcut Icon" href="desktop/images/zCloud.png" type="image/x-icon" />
    <link rel="stylesheet" href="desktop/desktop.css" type="text/css" />
    <script type="text/javascript" src="js/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="desktop/desktop.js"></script>
    <script type="text/javascript" src="../js/DBase.js"></script>

    <script src="https://code.highcharts.com.cn/highcharts/highcharts.js"></script>
    <script src="https://code.highcharts.com.cn/highcharts/modules/exporting.js"></script>
    <script src="https://code.highcharts.com.cn/highcharts/modules/boost.js"></script>
    <script src="https://code.highcharts.com.cn/highcharts/themes/sand-signika.js"></script>
    <script src="http://cdn.hcharts.cn/highcharts-plugins/highcharts-zh_CN.js"></script>


    <style>
        #webGL {
            height: calc(100% - 40px);
            width: 100%;
        }
        
        #label {
            position: absolute;
            padding: 10px;
            z-index: 999999;
            background: #00ff00;
            line-height: 1;
            border-radius: 5px;
            display: none;
            pointer-events: none;
        }
        
        .highChart {
            /*透明度 */
            opacity: 0.5;
            /*设置透明度 子元素不继承透明度*/
            margin: 0;
            right: 0px;
            z-index: 100;
            position: absolute;
        }
    </style>
</head>

<body>
    <div id="label"></div>
    <div id="desktopwrap" class="wrap clear">
        <div id="desktop" class="desktop">
            <div id="desktopContent" class="desktopContent clear">
                <!-- <iframe id='webGL' src="webGL.html" style="float: left;"></iframe> -->
            </div>
        </div>
        <div class="task">
            <div id="taskIcon">

            </div>
            <div id="showTime" class="showTime"></div>
            <div id="zCloud" class="zCloud"></div>
        </div>
    </div>
</body>
<script>
    $(document).ready(function() {
        var taskIcons = $('#taskIcon');
        var bodyWidth = $(window).width();
        var bodyHeight = $(window).height();
        var desktopContent = $('#desktopContent');

        //创建十三个界面任务栏图标
        var TableCols = ["name", "x", "y", "z", "monitorType", "eng_name"];
        var URL = "/ZcmDB|monitor_site|select * from sites order by x DESC;|";
        var data = window.selectDB(URL, TableCols);
        //console.log(data);
        for (let i in data) {
            let name = data[i]["name"];
            let eng_name = data[i]["eng_name"];

            //动态创建图标，显示在任务栏上
            var childdiv = $('<div></div>');
            childdiv.attr({
                "id": eng_name,
                "name": name,
                "class": 'taskIcon'
            });
            childdiv.css({
                "left": (bodyWidth - 180 - 40 * i),
            });
            taskIcons.append(childdiv);

            //动态创建highChart容器，显示在桌面上
            var highChartDiv = $('<div></div>');
            highChartDiv.attr({
                "id": eng_name + 'Chart',
                "class": 'highChart'
            });
            highChartDiv.append('<div class="windowMenuContent">ss</div>');

            desktopContent.append(highChartDiv);

            //添加鼠标悬浮事件
            $("#" + eng_name).hover(function(evt) {
                var xPos = evt.pageX || evt.clientX || evt.offsetX || evt.x;
                var yPos = $(window).height() - 80;

                $("#label").css({
                    left: xPos,
                    top: yPos,
                    display: 'block'
                });

                $("#label").html($(this).attr('name'))
            });

            //添加鼠标离开事件
            $("#" + eng_name).mouseleave(function(evt) {
                $("#label").css({
                    display: 'none'
                });
            });

            //添加鼠标点击事件
            $("#" + eng_name).click(function(evt) {
                TableCols = ["name", "ip", "channel", "number", "type",
                    "high_alert", "low_alert", "check_parameter",
                    "replace_sensor_id", "x", "y", "monitor_name"
                ];
                //所有截面
                URL = "/ZcmDB|sensor_info|select * from sensors where monitor_name = '" + eng_name + "';|";
                let data = window.selectDB(URL, TableCols);
                //console.log(data);

                //该截面所有的通道号
                TableCols = ["channel"];
                URL = "/ZcmDB|sensor_info|select distinct channel from sensors where monitor_name = '" + eng_name + "' order by channel;|";
                let channelData = window.selectDB(URL, TableCols);
                //console.log(channelData);

                //该截面该通道所有的传感器
                let currChannel = channelData[0]["channel"];
                TableCols = ["name", "ip", "channel", "number", "type",
                    "high_alert", "low_alert", "check_parameter",
                    "replace_sensor_id", "x", "y", "monitor_name"
                ];
                URL = "/ZcmDB|sensor_info|select * from sensors where monitor_name = '" + eng_name + "' and channel = '" + currChannel + "' order by number;|";
                let sensorsInChannel = window.selectDB(URL, TableCols);
                let series = [];
                //console.log(sensorsInChannel);
                for (let i in sensorsInChannel) {
                    var ip = sensorsInChannel[i]["ip"];
                    var number = sensorsInChannel[i]["number"];
                    TableCols = ["D0", "D" + number];
                    URL = "/ZcmDB|" + ip + "|select * from T" + currChannel + ";|";
                    let chartData = window.selectDB(URL, TableCols);
                    // console.log(chartData);
                    // console.log(URL);
                    series.push(chartData);
                }
                //console.log(series);

                //????????
                var chart = Highcharts.chart(eng_name + 'Chart', {
                    chart: {
                        zoomType: 'x'
                    },
                    title: {
                        useHTML: true,
                        text: "<label class='chartTitle'>" + name + "的数据</label>",
                        labels: {
                            formatter: function() {
                                return this.value;
                            }
                        },
                    },
                    subtitle: {
                        useHTML: true,
                        align: 'left',
                        text: '通道编号:    <span id="' + eng_name + 'Radios"></span>'
                    },
                    boost: {
                        useGPUTranslations: true
                    },
                    tooltip: {

                    },
                    series: []
                });

                //把该截面所有的通道显示在highchart上
                for (let i in channelData) {
                    let channelNum = channelData[i]["channel"];
                    let radio = $("<input type='radio' name='" + eng_name + "Radio' value='" + channelNum + "'/><label for='" + eng_name + "Radio'>" + channelNum + "   </label>");
                    if (i == 0)
                        radio = $("<input type='radio' name='" + eng_name + "Radio' value='" + channelNum + "' checked='true'/><label for='" + eng_name + "Radio'>" + channelNum + "    </label>");
                    $("#" + eng_name + "Radios").append(radio);
                }

                $(".highChart").hide();
                $("#" + eng_name + "Chart").show();
                //console.log($("input[name='" + eng_name + "Radio']:checked").val());

            });
        }


        //让highChartDiv可被鼠标拖拽
        //console.log($(".chartTitle"));
        $("label").click(function() {
            alert('s')
        });
        $(".chartTitle").each(function() {
            var flag = false,
                vHeight, vWidth, cHeight, cWdith;
            $(this).click(function() {
                alert('s')
            });
            // target.mousedown(function(e) {
            //     flag = true;
            //     vHeight = e.pageY;
            //     vWidth = e.pageX;
            //     cHeight = vHeight - $(this).offset().top;
            //     cWdith = vWidth - $(this).offset().left;
            //     //alert("divshow" + $(this).offset().top + " divvHeight" + vHeight);
            //     //alert("高" + cHeight + " 宽" + cWdith);
            // })

            // var showWidth = highChartDiv.width();
            // var showHeight = highChartDiv.height();
            // var documentWidth = $(document).width();
            // var documentHeight = $(document).height();

            // target.mousemove(function(e) {
            //     if (flag) {
            //         var divheight = e.pageY - cHeight; //窗口要移动到的位置
            //         var divwidth = e.pageX - cWdith; //窗口要移动到的位置
            //         //$("#la1").text(divheight + "w" + divwidth + "win" + showWidth + " x " + documentWidth + "" + showWidth);
            //         if (divwidth < 0) {
            //             divwidth = 0;
            //         }
            //         if (divheight < 50) {
            //             divheight = 50;
            //         }
            //         if (divwidth > documentWidth - showWidth) {
            //             divwidth = documentWidth - showWidth - 5;
            //         }
            //         if (divheight > documentHeight - showHeight) {
            //             divheight = documentHeight - showHeight - 5;
            //         }
            //         highChartDiv.css({
            //             "left": divwidth,
            //             "top": divheight
            //         });
            //     }
            // });

            // target.mouseup(function() {
            //     flag = false;
            // });
        });



        //默认打开北部雨棚西侧的监控窗口
        $("#northshackWest").trigger('click');
    });
</script>

</html>